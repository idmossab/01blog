<div class="dashboard-wrap">
  <section class="dashboard-card" *ngIf="!loading; else loadingState">
    <header class="dashboard-head">
      <h2>Admin Dashboard</h2>
      <p>Manage users, posts, and reports</p>
    </header>

    <nav class="tabs">
      <button type="button" [class.active]="tab === 'users'" (click)="tab = 'users'">
        Users ({{ users.length }})
      </button>
      <button type="button" [class.active]="tab === 'posts'" (click)="tab = 'posts'">
        Posts ({{ posts.length }})
      </button>
      <button type="button" [class.active]="tab === 'reports'" (click)="tab = 'reports'">
        Reports ({{ reportsCount }})
      </button>
    </nav>

    <section *ngIf="tab === 'users'" class="panel">
      <input
        class="search"
        type="text"
        [(ngModel)]="search"
        placeholder="Search users by name or email..."
      />

      <table class="table">
        <thead>
          <tr>
            <th>User</th>
            <th>Email</th>
            <th>Posts</th>
            <th>Followers</th>
            <th>Role</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filteredUsers">
            <td>
              <button class="user-link" type="button" (click)="openProfile(item.userId)">
                {{ item.userName }}
              </button>
            </td>
            <td>{{ item.email }}</td>
            <td>{{ userPostsCount[item.userId] || 0 }}</td>
            <td>0</td>
            <td>
              <button
                class="badge role-action"
                type="button"
                [class.admin]="item.role === 'ADMIN'"
                [disabled]="!canChangeRole(item)"
                (click)="toggleUserRole(item)"
              >
                {{ item.role === 'ADMIN' ? 'Admin' : 'User' }}
              </button>
            </td>
            <td>
              <span class="badge" [class.active-status]="item.status === 'ACTIVE'" [class.banned]="item.status === 'BANNED'">
                {{ item.status }}
              </span>
            </td>
            <td>
              <button
                class="action"
                type="button"
                (click)="toggleUserStatus(item)"
                [disabled]="item.role === 'ADMIN' || item.userId === user?.userId"
              >
                {{ item.status === 'BANNED' ? 'Unban' : 'Ban' }}
              </button>
              <button
                class="action delete-action"
                type="button"
                (click)="deleteUser(item)"
                [disabled]="item.role === 'ADMIN' || item.userId === user?.userId"
              >
                Delete
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </section>

    <section *ngIf="tab === 'posts'" class="panel">
      <table class="table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Author</th>
            <th>Status</th>
            <th>Created</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let post of posts">
            <td>{{ post.title }}</td>
            <td>{{ post.userName || 'Unknown' }}</td>
            <td>{{ post.status }}</td>
            <td>{{ post.createdAt ? (post.createdAt | date:'medium') : '-' }}</td>
          </tr>
          <tr *ngIf="!posts.length">
            <td colspan="4">No posts found.</td>
          </tr>
        </tbody>
      </table>
    </section>

    <section *ngIf="tab === 'reports'" class="panel reports">
      <div class="report-card">
        <div class="label">Total Reports</div>
        <div class="value">{{ reportsCount }}</div>
      </div>
    </section>

    <div class="error" *ngIf="error">{{ error }}</div>
  </section>
</div>

<ng-template #loadingState>
  <div class="dashboard-card">
    <div class="loading">Loading dashboard...</div>
  </div>
</ng-template>
